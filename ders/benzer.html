<!DOCTYPE html>
<html lang="en-US">
<meta charset="UTF-8">
<meta name="viewport"    content="width=device-width">
<meta name="author"      content="M A Eyler, Istanbul, 2021" />
<meta name="description" content="Words from Quran" />
<link rel="stylesheet" href="ders.css" media="all">
<link rel="icon" href="/Kuran/image/icon.png">
<title>Benzerlik Öbekleri </title>
<style>
    pre {
        text-wrap: wrap;
    }
    .column {
        display: inline-block;
        width: 160px;
    }
    button {
        border: 2px solid;
        border-radius: 5px;
        cursor: pointer;
        padding: 3px 6px;
    }
    .action {
        width: 50px;
        margin: 4px;
    }
</style>
<h2>Benzerlik Öbekleri &emsp;
    <button class=goBack title="Derslere git">◀</button></h2>
<div id=buttons hidden>
    Sure:Ayet <input type=search id=inp size=10 />&ensp;
    <button id=bul title="Ayetin benzerlerini bul">Öbek</button>&ensp;
    <button id=sil title="Bütün satırları sil">Sil</button>&ensp;
    <button id=und title="Son satırı geri al">&lt;</button>&ensp;
</div>
<pre id=out></pre>
Burada seçilen 37:76 ayeti, kendisine benzeyen diğer iki ayetle birlikte üçlü bir öbek oluşturuyor. Yukarıdaki ayet numaralarına dokunarak Iqra yazılımı içinde ayeti görebilirsiniz. Benzeri olan ayetlerin numarası mavi işaretli bir menüdür, bu menüden benzer ayetlere geçilebilir.
<p>Benzerlik öbeklerinin çoğu ayet çiftleri olmakla birlikte, 40'tan fazla ayet içeren bir öbek de mevcut.</p>
<div class=column>
    <b>Küçük öbekler:</b> <br>
    <button class=action>21:7</button>&ensp; İkili <br>
    <button class=action>16:29</button>&ensp; Üçlü <br>
    <button class=action>40:53</button>&ensp; Dörtlü <br>
    <button class=action>36:4</button>&ensp; Dokuzlu <br>
</div>
<div class=column>
    <b>En büyük öbekler:</b> <br>
    <button class=action>2:33</button>&ensp; 34'lü <br>
    <button class=action>2:32</button>&ensp; 35'li <br>
    <button class=action>13:1</button>&ensp; 36'lı <br>
    <button class=action>11:4</button>&ensp; 44'lü <br>
</div>
<br><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/a06e2TbkRiY" 
  title="YouTube video player" frameborder="0"  allowfullscreen
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
</iframe>
<h3>Benzerlik ne işe yarar?</h3>
<ul>
    <li>Ayetleri anlamakta yardımcı olur: Bir kelime dizisinin farklı bağlamlardaki anlamı da ilişkili olmalı. Böyle bir ayete anlam verirken, benzer ayetlerin anlamı göz önüne alınmalı. <br>
    <a href="/Kuran/benzerlik.html" target=Kuran>Benzerlik örnekleri</a>
    <li>Korunmuşluğun göstergesidir: Aynı kelime dizisi, farklı ayetlerde farklı edat ya da bağlaçlarla geçiyorsa, bu ayrıntının 1400 yıl korunmuş olması Kuran-ı Kerim'in açık bir mucizesidir. <br>
    <a href="/Kitap/KK/korunmus.html" target=Kuran>Korunmuşluk örnekleri</a>
</ul>
<p>Yukarıdaki ilk madde, Kitabımızı anlamak için elbette daha önemli. Lakin, yazılımda kullanılan "mavi işaretli ayetler" anlam yönünde çok fayda sağlamadı. Öte yandan, ikinci maddedeki korunmuşluğun göstergesi olan bir çok örneği bu yöntemle buldum. <br>

<h3>Benzerlik nasıl bulunur?</h3>
<p>A Rajab'in FSMV Üniversitesinde mezuniyet projesi olarak yaptığı <b>Rehber</b> yazılımının <b>Simi</b> modülü verilen bir ayetin benzerlerini bulur. Örnek olarak seçilen ayetin benzerlerini şu linkte görebilirsiniz: <br>
<a href="https://okuyun.github.io/Rehber/simi#39:72" target=simi>okuyun.github.io/Rehber/simi#39:72</a>
<p>Iqra içinde, <b>Simi</b> modülünün hazırladığı benzerlik dosyası kullanılıyor:<br>
<a href="https://okuyun.github.io/Kuran/data/simi.txt" target=Kuran>okuyun.github.io/Kuran/data/simi.txt</a><br>
Bu dosyada bulunan ayetlerin numarası, Iqra yazılımımnda mavi renkle gösterilen bir menü olarak çalışır. Bir uygulama kısıtı: eleman sayısını 12 ile sınırladık. Benzer ayetler varsa, bu menüden kolayca seçilir. Mesela Neml suresinin 30. ayetinden 3 farklı yere gidebiliriz:<br>
    <img src="/Kitap/KK/neml 30.png">
<p>Metin benzerliği alanında iyi bilinen <a href="https://en.wikipedia.org/wiki/Cosine_similarity" target=Kuran>kosinüs ölçüsünü</a> kullandık. Her ayette geçen isim, sıfat ve fiillerin kökleri ile bir vektör yaptık. İki ayetin benzerliği, vektörlerin arasındaki açının kosinüsü olarak tanımlandı. Deneme-yanılma ile bulunan 0.8 gibi sabit bir değerin üstündeki ayet çiftleri benzerlik dosyasına eklendi.
<p>Bu şekilde tanımlanan benzerlik bağıntısı simetriktir: A B'ye benziyorsa, B A'ya benzer. Fakat geçişli (transitive) değildir: A B'ye ve B C'ye benziyorsa, A C'ye benzemek zorunda değil. Benzerlik öbeklerini "transitive closure" olarak görebiliriz. Lakin, uygulamada mavi menülerdeki ayet sayısına koyduğumuz 12 sınırı, bazı yerlerde simetriyi bozuyor. Bu nedenle, öbekler denklik bağıntısı üretmiyor, bazı ayetlerden başlayınca öbeğin tamamı görülmüyor.
<br> &emsp;
<script src="/Kuran/code/utilities.js"></script>
<script>
"use strict";
var data = []  //previous data used in report()
var simi = {}  //Array of verses similar to 'c:v'
function init() {
    if (!parent.iqra) {
        let err = "This code works only within Iqra"
        let link = "Open: okuyun.github.io/Kuran/#d=benzer"
        out.innerText = err+'\n'+link
        throw err
    }
    function addToMap(x) {
        let m = simi[x] 
        if (!m) {
           m = new Set(); m.add(x); simi[x] = m
        }
        return m
    }
    for (let i in parent.iqra.Q.simi._data) {
        let s = parent.iqra.Q.simi._data[i]
        let mm = addToMap(new Verse(i).cv)
        for (let x of s.split(' ')) {
            mm.add(x); simi[x] = mm
        }
    }
    let n = Object.getOwnPropertyNames(simi).length
    console.log(n+" verses have similarity")
    for (let cv in simi) {
        //convert Set to Array and sort each entry in idx
        let a = [...simi[cv]].map(Verse.fromCV)
        simi[cv] = a.sort((x,y) => x.idx-y.idx)
    }
}
class Verse {
    constructor(i, c, v) {
        this.idx = i
        if (!c) [c, v] = toCV(i)
        this.chap = c
        this.verse = v
    }
    get cv() {
        return this.chap+':'+this.verse
    }
    toHTML() {
        return `<a href="/Kuran/reader.html#v=${this.cv}" 
            target="iqra">${this.cv}</a>`
    }
    toString() {
        return this.cv
    }
    static fromNumbers(c, v) {
        return new Verse(indexOf(c, v), c, v)
    }
    static fromCV(cv) {
        let [c, v] = cv.split(':')
        if (isNaN(v)) return null
        return Verse.fromNumbers(Number(c), Number(v))
    }
}
function report(cv=inp.value) {
    function toText(a) {
        let convert = v => v.toHTML()
        if (!a) return cv+" benzeri yok"
        return cv+' -- '+a.length+' ayet\n'
                 +a.map(convert).join(' ')
    }
    if (!/\d+:\d+/.test(cv)) { //Normalize
        let [c, v] = cv.split(/\D/)
        if (!cv || !v) return
        cv = c+':'+v
    }
    if (data.length > 9) data.shift()
    data.push(toText(simi[cv]))
    showData()
}
function showData() {
    out.innerHTML = data.join('\n')
}
sil.onclick = () => {
    data.length = 0
    showData()
}
und.onclick = () => {
    if (data.length > 0) data.pop()
    showData()
}
init(); buttons.hidden = false
inp.onchange = bul.onclick = (evt) => report()
inp.value = '37:76'; report()
for (let b of document.querySelectorAll('.action'))
    b.onclick = (evt) => report(b.textContent)
</script>

<script src="init.js"></script>
